<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>–ö–∞—Ç–∞–ª–æ–≥ - –ö–Ω–∏–∂–Ω—ã–π –º–∞–≥–∞–∑–∏–Ω</title>
    <link rel="stylesheet" href="/stylesheets/style.css" />
</head>
<body>
    <nav>
        <a href="/home" class="logo">–ö–Ω–∏–∂–Ω—ã–π –º–∞–≥–∞–∑–∏–Ω</a>
        <ul>
            <li><a href="/home">–ì–ª–∞–≤–Ω–∞—è</a></li>
            <li><a href="/catalog">–ö–∞—Ç–∞–ª–æ–≥</a></li>
            <li>
                <a href="/cart" class="cart-link">
                    –ö–æ—Ä–∑–∏–Ω–∞
                    <% if (typeof cartItemsCount !== 'undefined' && cartItemsCount > 0) { %>
                    <span class="cart-badge"><%= cartItemsCount %></span>
                    <% } %>
                </a>
            </li>
            <% if (typeof user !== 'undefined' && user) { %>
            <li><a href="/profile">–ü—Ä–æ—Ñ–∏–ª—å</a></li>
            <li><a href="/logout">–í—ã–π—Ç–∏</a></li>
            <% } else { %>
            <li><a href="/login">–í–æ–π—Ç–∏</a></li>
            <% } %>
        </ul>
    </nav>

    <div class="content-wrapper">
        <h1>–ö–∞—Ç–∞–ª–æ–≥ –∫–Ω–∏–≥</h1>
        
        <% if (products && products.length > 0) { %>
        <div class="products-grid">
            <% products.forEach(product => { %>
            <div class="product-card">
                <div class="product-image">
                    üìñ
                </div>
                <div class="product-info">
                    <h3><%= product.name %></h3>
                    <div class="category"><%= product.category || '–ë–µ–∑ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏' %></div>
                    <div class="description"><%= product.description || '' %></div>
                    <div class="price"><%= product.price %> ‚ÇΩ</div>
                    <div style="margin-bottom: 0.5rem; color: #666; font-size: 0.9rem;">
                        –í –Ω–∞–ª–∏—á–∏–∏: <%= product.stock %> —à—Ç.
                    </div>
                    <% if (product.stock > 0) { %>
                    <button class="btn btn-primary" onclick="addToCart(<%= product.id %>)">
                        –í –∫–æ—Ä–∑–∏–Ω—É
                    </button>
                    <% } else { %>
                    <button class="btn" disabled style="background: #ccc; cursor: not-allowed;">
                        –ù–µ—Ç –≤ –Ω–∞–ª–∏—á–∏–∏
                    </button>
                    <% } %>
                </div>
            </div>
            <% }); %>
        </div>
        <% } else { %>
        <div style="text-align: center; padding: 4rem 2rem;">
            <h2>–ö–Ω–∏–≥–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</h2>
            <p>–ö —Å–æ–∂–∞–ª–µ–Ω–∏—é, –≤ –¥–∞–Ω–Ω—ã–π –º–æ–º–µ–Ω—Ç –∫–∞—Ç–∞–ª–æ–≥ –ø—É—Å—Ç.</p>
        </div>
        <% } %>
    </div>

    <script>
        function addToCart(productId) {
            fetch('/cart/add', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ productId: productId })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    alert('–¢–æ–≤–∞—Ä –¥–æ–±–∞–≤–ª–µ–Ω –≤ –∫–æ—Ä–∑–∏–Ω—É!');
                    location.reload();
                } else {
                    alert(data.message || '–û—à–∏–±–∫–∞ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ —Ç–æ–≤–∞—Ä–∞');
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–æ–π–¥–∏—Ç–µ –≤ —Å–∏—Å—Ç–µ–º—É.');
            });
        }
    </script>
</body>
</html>

