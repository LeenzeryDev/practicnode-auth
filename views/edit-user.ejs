<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <title>–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</title>
    <link rel="stylesheet" href="../../stylesheets/style.css"/>
</head>
<body class="login-page">
<div class="container">
    <h1>–ò–∑–º–µ–Ω–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</h1>
    
    <div style="text-align: center; margin: 2rem 0;">
        <div id="avatarPreview" style="width: 120px; height: 120px; margin: 0 auto; border-radius: 50%; overflow: hidden; border: 3px solid #007bff; background: #f0f2f5; display: flex; align-items: center; justify-content: center;">
            <% if (user.avatar) { %>
            <img src="<%= user.avatar %>" alt="Avatar" style="width: 100%; height: 100%; object-fit: cover;">
            <% } else { %>
            <span style="font-size: 3rem; color: #ccc;">üë§</span>
            <% } %>
        </div>
        <label for="avatarInput" style="display: inline-block; margin-top: 1rem; cursor: pointer; color: #007bff;">
            –ò–∑–º–µ–Ω–∏—Ç—å —Ñ–æ—Ç–æ
        </label>
        <input type="file" id="avatarInput" accept="image/*" style="display: none;">
    </div>
    
    <form id="editUserForm" method="POST" action="/admin/edit-user/<%= user.id %>">
        <input type="hidden" id="avatarData" name="avatar" value="">
        
        <label for="username">–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:</label>
        <input type="text" id="username" name="username" value="<%= user.username %>" required>

        <label for="password">–ü–∞—Ä–æ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:</label>
        <input type="password" id="password" name="password" value="<%= user.password %>" required>

        <label for="role">–†–æ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:</label>
        <select id="role" name="roleId" required>
            <% roles.forEach(role => { %>
            <option value="<%= role.id %>" <%= role.id === user.roleId ? 'selected' : '' %>><%= role.name %></option>
            <% }) %>
        </select>

        <button type="submit">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
    </form>
    <p style="margin-top: 1rem;"><a href="/admin/panel">–í–µ—Ä–Ω—É—Ç—å—Å—è</a></p>
</div>

<script>
    const avatarInput = document.getElementById('avatarInput');
    const avatarPreview = document.getElementById('avatarPreview');
    const avatarData = document.getElementById('avatarData');

    avatarInput.addEventListener('change', function(e) {
        const file = e.target.files[0];
        if (file) {
            if (file.size > 5 * 1024 * 1024) {
                alert('–§–∞–π–ª —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π. –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä: 5MB');
                return;
            }

            if (!file.type.startsWith('image/')) {
                alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ');
                return;
            }

            const reader = new FileReader();
            reader.onload = function(event) {
                const base64String = event.target.result;
                avatarPreview.innerHTML = `<img src="${base64String}" alt="Avatar" style="width: 100%; height: 100%; object-fit: cover;">`;
                avatarData.value = base64String;
            };
            reader.readAsDataURL(file);
        }
    });
</script>
</body>
</html>
