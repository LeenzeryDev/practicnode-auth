<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>–ü—Ä–æ—Ñ–∏–ª—å - –ö–Ω–∏–∂–Ω—ã–π –º–∞–≥–∞–∑–∏–Ω</title>
    <link rel="stylesheet" href="/stylesheets/style.css" />
</head>
<body>
    <nav>
        <a href="/home" class="logo">–ö–Ω–∏–∂–Ω—ã–π –º–∞–≥–∞–∑–∏–Ω</a>
        <ul>
            <li><a href="/home">–ì–ª–∞–≤–Ω–∞—è</a></li>
            <li><a href="/catalog">–ö–∞—Ç–∞–ª–æ–≥</a></li>
            <li>
                <a href="/cart" class="cart-link">
                    –ö–æ—Ä–∑–∏–Ω–∞
                    <% if (typeof cartItemsCount !== 'undefined' && cartItemsCount > 0) { %>
                    <span class="cart-badge"><%= cartItemsCount %></span>
                    <% } %>
                </a>
            </li>
            <li>
                <a href="/profile" class="user-info">
                    <% if (typeof userAvatar !== 'undefined' && userAvatar) { %>
                    <img src="<%= userAvatar %>" alt="Avatar" class="user-avatar">
                    <% } else { %>
                    <span style="font-size: 1.5rem; margin-right: 0.5rem;"></span>
                    <% } %>
                    –ü—Ä–æ—Ñ–∏–ª—å
                </a>
            </li>
            <li><a href="/logout">–í—ã–π—Ç–∏</a></li>
        </ul>
    </nav>

    <div class="content-wrapper">
        <div class="container" style="max-width: 600px; margin: 2rem auto;">
            <h1>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –ø—Ä–æ—Ñ–∏–ª—å!</h1>
            <p>–í—ã —É—Å–ø–µ—à–Ω–æ –≤–æ—à–ª–∏ –≤ —Å–∏—Å—Ç–µ–º—É.</p>
            
            <div style="text-align: center; margin: 2rem 0;">
                <div id="avatarPreview" style="width: 150px; height: 150px; margin: 0 auto; border-radius: 50%; overflow: hidden; border: 3px solid #007bff; background: #f0f2f5; display: flex; align-items: center; justify-content: center;">
                    <% if (userAvatar) { %>
                    <img src="<%= userAvatar %>" alt="Avatar" style="width: 100%; height: 100%; object-fit: cover;">
                    <% } else { %>
                    <span style="font-size: 4rem; color: #ccc;">üë§</span>
                    <% } %>
                </div>
                <label for="avatarInput" style="display: inline-block; margin-top: 1rem; cursor: pointer; color: #007bff;">
                    –ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–æ—Ç–æ
                </label>
                <input type="file" id="avatarInput" accept="image/*" style="display: none;">
            </div>

            <h2>–ó–¥–µ—Å—å –≤—ã –º–æ–∂–µ—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å –≤–∞—à–∏ –¥–∞–Ω–Ω—ã–µ</h2>
            <form id="profileForm" method="POST" action="/profileUpdate">
                <input type="hidden" id="avatarData" name="avatar" value="">
                
                <label for="username">–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:</label>
                <input type="text" id="username" name="username" required />

                <label for="password">–ü–∞—Ä–æ–ª—å:</label>
                <input type="password" id="password" name="password" required />

                <button type="submit">–ò–∑–º–µ–Ω–∏—Ç—å –¥–∞–Ω–Ω—ã–µ</button>
            </form>
            <p style="margin-top: 1rem;"><a href="/logout">–í—ã–π—Ç–∏</a></p>
        </div>
    </div>

    <script>
        const avatarInput = document.getElementById('avatarInput');
        const avatarPreview = document.getElementById('avatarPreview');
        const avatarData = document.getElementById('avatarData');

        avatarInput.addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                if (file.size > 5 * 1024 * 1024) {
                    alert('–§–∞–π–ª —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π. –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä: 5MB');
                    return;
                }

                if (!file.type.startsWith('image/')) {
                    alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ');
                    return;
                }

                const reader = new FileReader();
                reader.onload = function(event) {
                    const base64String = event.target.result;
                    
                    avatarPreview.innerHTML = `<img src="${base64String}" alt="Avatar" style="width: 100%; height: 100%; object-fit: cover;">`;
                    
                    avatarData.value = base64String;
                };
                reader.readAsDataURL(file);
            }
        });
    </script>
</body>
</html>
